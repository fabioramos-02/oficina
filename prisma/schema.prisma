// Arquivo de Modelagem de Dados para o Prisma
// Este arquivo deve ser colocado no diretório 'prisma' do seu projeto backend.

generator client {
  provider = "prisma-client"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql" // Ou "mysql", dependendo da sua escolha
}




// generator docs {
//   provider = "node node_modules/prisma-docs-generator/dist/index.js"
//   output   = "../public/prisma-docs"
// }

// -----------------------------------------------------------------------------
// ENUMS
// -----------------------------------------------------------------------------

enum StatusLicenca {
  ATIVA
  INATIVA
  EXPIRADA
}

enum StatusOrdemServico {
  ABERTA
  EM_ANDAMENTO
  AGUARDANDO_PECA
  FINALIZADA
  CANCELADA
}

enum FuncaoUsuario {
  ADMIN
  OPERADOR
}

enum TipoCliente {
  PF
  PJ
}

enum OrigemCliente {
  INDICACAO
  INSTAGRAM
  GOOGLE
  FACEBOOK
  OUTROS
}

// -----------------------------------------------------------------------------
// MODELS
// -----------------------------------------------------------------------------

model Licenca {
  id         String        @id @default(uuid())
  status     StatusLicenca @default(ATIVA)
  dataInicio DateTime      @default(now())
  dataFim    DateTime
  
  usuarios   Usuario[]
}

model Usuario {
  id        String        @id @default(uuid())
  email     String        @unique
  hashSenha String
  funcao    FuncaoUsuario @default(OPERADOR)
  
  licencaId String
  licenca   Licenca       @relation(fields: [licencaId], references: [id])
}

model Cliente {
  id            String         @id @default(uuid())
  nome          String
  
  // Origem e Tipo
  origemCliente OrigemCliente?
  tipoCliente   TipoCliente    @default(PF)
  
  // Documentos
  cpf           String?
  cnpj          String?
  
  // Contato
  email         String?
  telefone      String?
  telefoneExtra String?
  
  // Endereço Estruturado
  cep           String?
  logradouro    String?
  numero        String?
  complemento   String?
  bairro        String?
  cidade        String?
  estado        String?
  
  // Detalhes
  dataNascimento DateTime?
  anotacoes      String?
  
  // Relacionamentos
  veiculos      Veiculo[]
  ordensServico OrdemServico[]

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Veiculo {
  id            String         @id @default(uuid())
  placa         String         @unique
  marca         String
  modelo        String
  ano           Int?
  
  clienteId     String
  cliente       Cliente        @relation(fields: [clienteId], references: [id])
  
  ordensServico OrdemServico[]
}

model OrdemServico {
  id         String             @id @default(uuid())
  status     StatusOrdemServico @default(ABERTA)
  dataInicio DateTime           @default(now())
  dataFim    DateTime?
  valorTotal Float              @default(0.0)
  
  clienteId  String
  cliente    Cliente            @relation(fields: [clienteId], references: [id])
  
  veiculoId  String?
  veiculo    Veiculo?           @relation(fields: [veiculoId], references: [id])
  
  itens      ItemServico[]
}

model ItemServico {
  id             String       @id @default(uuid())
  descricao      String
  valorUnitario  Float
  quantidade     Int
  
  ordemServicoId String
  ordemServico   OrdemServico @relation(fields: [ordemServicoId], references: [id])
}
