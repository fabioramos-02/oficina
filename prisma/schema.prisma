// Arquivo de Modelagem de Dados para o Prisma
// Este arquivo deve ser colocado no diretório 'prisma' do seu projeto backend.

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql" // Ou "mysql", dependendo da sua escolha
}




// generator docs {
//   provider = "node node_modules/prisma-docs-generator/dist/index.js"
//   output   = "../public/prisma-docs"
// }

// -----------------------------------------------------------------------------
// ENUMS
// -----------------------------------------------------------------------------

enum StatusLicenca {
  ATIVA
  INATIVA
  EXPIRADA
}

enum StatusOrdemServico {
  EM_ANDAMENTO
  CONCLUIDO
  CANCELADO
}

enum TipoDesconto {
  VALOR
  PORCENTAGEM
}

enum FuncaoUsuario {
  ADMIN
  OPERADOR
}

enum TipoCliente {
  PF
  PJ
}

enum OrigemCliente {
  INDICACAO
  INSTAGRAM
  GOOGLE
  FACEBOOK
  OUTROS
}

// -----------------------------------------------------------------------------
// MODELS
// -----------------------------------------------------------------------------

model Licenca {
  id         String        @id @default(uuid())
  status     StatusLicenca @default(ATIVA)
  dataInicio DateTime      @default(now())
  dataFim    DateTime
  
  usuarios   Usuario[]
}

model Usuario {
  id        String        @id @default(uuid())
  email     String        @unique
  hashSenha String
  funcao    FuncaoUsuario @default(OPERADOR)
  
  licencaId String
  licenca   Licenca       @relation(fields: [licencaId], references: [id])
}

model Cliente {
  id            String         @id @default(uuid())
  nome          String
  
  // Origem e Tipo
  origemCliente OrigemCliente?
  tipoCliente   TipoCliente    @default(PF)
  
  // Documentos
  cpf           String?
  cnpj          String?
  
  // Contato
  email         String?
  telefone      String?
  telefoneExtra String?
  
  // Endereço Estruturado
  cep           String?
  logradouro    String?
  numero        String?
  complemento   String?
  bairro        String?
  cidade        String?
  estado        String?
  
  // Detalhes
  dataNascimento DateTime?
  anotacoes      String?
  
  // Relacionamentos
  veiculos      Veiculo[]
  ordensServico OrdemServico[]

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Veiculo {
  id            String         @id @default(uuid())
  placa         String         @unique
  marca         String
  modelo        String
  ano           Int
  
  clienteId     String
  cliente       Cliente        @relation(fields: [clienteId], references: [id])
  
  ordensServico OrdemServico[]
}

model OrdemServico {
  id              String             @id @default(uuid())
  numero          Int
  ano             Int
  status          StatusOrdemServico @default(EM_ANDAMENTO)
  dataCriacao     DateTime           @default(now())
  dataFinalizacao DateTime?
  observacoes     String?

  // Financials
  valorServicos   Float              @default(0.0)
  valorPecas      Float              @default(0.0)
  valorSubtotal   Float              @default(0.0)
  tipoDesconto    TipoDesconto       @default(VALOR)
  desconto        Float              @default(0.0)
  valorDesconto   Float              @default(0.0)
  valorTotal      Float              @default(0.0)
  
  clienteId       String
  cliente         Cliente            @relation(fields: [clienteId], references: [id])
  
  veiculoId       String?
  veiculo         Veiculo?           @relation(fields: [veiculoId], references: [id])
  
  // Vehicle Snapshot
  veiculoKm          Float?
  veiculoCombustivel String?
  defeitoRelatado    String?
  veiculoObservacoes String?
  
  pecas           OrdemServicoPeca[]
  servicos        OrdemServicoServico[]

  @@unique([numero, ano])
}

model Peca {
  id                String             @id @default(uuid())
  nome              String
  descricao         String?
  categoria         String?
  codigo            String             @unique
  precoCusto        Float
  precoVenda        Float
  quantidadeEstoque Int
  
  ordensServico     OrdemServicoPeca[]
}

model Servico {
  id            String                @id @default(uuid())
  nome          String
  descricao     String?
  categoria     String?
  preco         Float
  
  ordensServico OrdemServicoServico[]
}

model OrdemServicoPeca {
  id             String       @id @default(uuid())
  
  ordemServicoId String
  ordemServico   OrdemServico @relation(fields: [ordemServicoId], references: [id])
  
  pecaId         String
  peca           Peca         @relation(fields: [pecaId], references: [id])
  
  quantidadeUtilizada    Int
  precoUnitarioUtilizado Float
}

model OrdemServicoServico {
  id             String       @id @default(uuid())
  
  ordemServicoId String
  ordemServico   OrdemServico @relation(fields: [ordemServicoId], references: [id])
  
  servicoId      String
  servico        Servico      @relation(fields: [servicoId], references: [id])
  
  quantidade     Int
  precoUnitario  Float
}
